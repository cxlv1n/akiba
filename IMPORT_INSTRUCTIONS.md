# Инструкция по импорту данных из DLE в Django

## Шаг 1: Применение миграций

Сначала нужно применить миграции для новых полей модели `Car`:

```bash
# Активируйте виртуальное окружение
source .venv/bin/activate  # или venv/bin/activate

# Примените миграции
python manage.py migrate
```

## Шаг 2: Импорт данных

Запустите команду импорта:

```bash
# Импорт с очисткой существующих данных
python manage.py import_from_dle --clear

# Или импорт без очистки (добавление к существующим)
python manage.py import_from_dle
```

### Параметры команды:

- `--sql-file PATH` - путь к SQL файлу (по умолчанию: `akiba_base.sql`)
- `--clear` - очистить существующие данные перед импортом

## Что импортируется:

1. **Автомобили** из таблицы `dle_post`:
   - Название, производитель, модель
   - Год выпуска, цена
   - Пробег, тип топлива, привод, тип кузова, объём двигателя
   - Наличие (в наличии / под заказ / продано)
   - URL-имя (alt_name)

2. **Изображения**:
   - Основное изображение из поля `image1` в xfields
   - Дополнительные изображения из поля `gallery` в xfields
   - Изображения из таблицы `dle_images`

3. **Категории** для определения страны происхождения:
   - Корея (KR)
   - Япония (JP)
   - Китай (CN)

## Структура данных в xfields:

- `image1` - основное изображение (путь в папке `posts/`)
- `gallery` - дополнительные изображения (через запятую)
- `brand` - бренд (Honda, Toyota, Kia...)
- `god` - год выпуска
- `cena1` - цена
- `kuzov` - тип кузова
- `dvig` - тип двигателя
- `ob` - объём двигателя
- `priv` - привод
- `probeg` - пробег
- `nalichie` - наличие

## Примечания:

- Фотографии должны находиться в папке `posts/` в корне проекта
- Изображения копируются в `media/cars/gallery/` при импорте
- Если изображение не найдено, оно пропускается с предупреждением
- Импорт может занять несколько минут в зависимости от количества записей

## Проверка результата:

После импорта проверьте:

```bash
# Количество импортированных автомобилей
python manage.py shell
>>> from catalog.models import Car
>>> Car.objects.count()

# Количество изображений
>>> from catalog.models import CarImage
>>> CarImage.objects.count()
```

